
@model QLDatVeMayBay.ViewModels.TaiKhoan.ChinhSuaHoSoViewModel

@{
    ViewData["Title"] = "Chỉnh sửa hồ sơ";
}

<h3 class="mb-4 text-center text-primary fw-bold">Chỉnh sửa hồ sơ cá nhân</h3>

@if (TempData["Success"] != null)
{
    <script>
        window.onload = function () {
            var toast = document.getElementById("toastSuccess");
            if (toast) {
                toast.style.display = "block";
                setTimeout(() => toast.style.opacity = "1", 100);

                setTimeout(function () {
                    toast.style.opacity = "0";
                    setTimeout(() => toast.style.display = "none", 500);
                }, 3000);
            }
        }
    </script>
}


<form asp-action="CaNhan" method="post" id="profileForm">
    <input type="hidden" asp-for="IDNguoiDung" />

    <div class="mb-3">
        <label asp-for="HoTen" class="form-label">Họ Tên</label>
        <input asp-for="HoTen" class="form-control" />
        <span asp-validation-for="HoTen" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Email" class="form-label"></label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="SoDienThoai" class="form-label">Số Điện Thoại</label>
        <input asp-for="SoDienThoai" class="form-control" />
        <span asp-validation-for="SoDienThoai" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="GioiTinh" class="form-label">Giới Tính</label>
        <select asp-for="GioiTinh" class="form-select">
            <option value="">-- Chọn giới tính --</option>
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
            <option value="Khác">Khác</option>
        </select>
        <span asp-validation-for="GioiTinh" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="QuocTich" class="form-label">Quốc tịch</label>
        <select asp-for="QuocTich" class="form-select">
            <option value="">-- Chọn quốc tịch --</option>
            <option value="Việt Nam">🇻🇳 Việt Nam</option>
            <option value="Nhật Bản">🇯🇵 Nhật Bản</option>
            <option value="Hàn Quốc">🇰🇷 Hàn Quốc</option>
            <option value="Trung Quốc">🇨🇳 Trung Quốc</option>
            <option value="Thái Lan">🇹🇭 Thái Lan</option>
            <option value="Mỹ">🇺🇸 Mỹ</option>
            <option value="Anh">🇬🇧 Anh</option>
            <option value="Pháp">🇫🇷 Pháp</option>
            <option value="Đức">🇩🇪 Đức</option>
            <option value="Nga">🇷🇺 Nga</option>
            <option value="Canada">🇨🇦 Canada</option>
            <option value="Úc">🇦🇺 Úc</option>
            <option value="Singapore">🇸🇬 Singapore</option>
            <option value="Malaysia">🇲🇾 Malaysia</option>
            <option value="Indonesia">🇮🇩 Indonesia</option>
            <option value="Ấn Độ">🇮🇳 Ấn Độ</option>
            <option value="Ý">🇮🇹 Ý</option>
            <option value="Hà Lan">🇳🇱 Hà Lan</option>
            <option value="Tây Ban Nha">🇪🇸 Tây Ban Nha</option>
            <option value="Brazil">🇧🇷 Brazil</option>
        </select>
        <span asp-validation-for="QuocTich" class="text-danger"></span>
    </div>


    <div class="mb-3">
        <label asp-for="CCCD" class="form-label"></label>
        <input asp-for="CCCD" class="form-control" />
        <span asp-validation-for="CCCD" class="text-danger"></span>
    </div>

    <div class="text-center mt-4">
        <button type="button" id="btnShowConfirm" class="btn btn-primary px-4 py-2">
            Lưu thay đổi
        </button>
    </div>
</form>
<div id="confirmModal"
     style="
        display:none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        z-index: 9998;
        align-items: center;
        justify-content: center;
     ">
    <div style="
        background: #fff;
        border-radius: 12px;
        padding: 24px 28px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        text-align: center;
     ">
        <h5 class="mb-3">Xác nhận lưu thay đổi</h5>
        <p class="mb-4">
            Bạn có chắc chắn muốn lưu các thay đổi thông tin hồ sơ không?
        </p>
        <div class="d-flex justify-content-center gap-2">
            <button type="button" id="btnCancelSave" class="btn btn-secondary me-2">
                Quay lại
            </button>
            <button type="button" id="btnConfirmSave" class="btn btn-primary">
                Xác nhận
            </button>
        </div>
    </div>
</div>

<div id="toastSuccess"
     style="
        display:none;
        position: fixed;
        top: 30px;
        right: 30px;
        background: #4caf50;
        color: white;
        padding: 12px 18px;
        border-radius: 8px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        font-size: 15px;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.5s;
     ">
    ✔ Cập nhật thông tin thành công!
</div>


    @section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var btnShow = document.getElementById("btnShowConfirm");
            var modal = document.getElementById("confirmModal");
            var btnCancel = document.getElementById("btnCancelSave");
            var btnConfirm = document.getElementById("btnConfirmSave");
            var form = document.getElementById("profileForm");

            // Bấm “Lưu thay đổi” => kiểm tra form rồi mở popup
            btnShow.addEventListener("click", function () {

                // Nếu form có validate lỗi => không mở popup
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                modal.style.display = "flex";  // mở popup
            });

            // Bấm "Quay lại" => đóng popup
            btnCancel.addEventListener("click", function () {
                modal.style.display = "none";
            });

            // Bấm "Xác nhận" => submit form
            btnConfirm.addEventListener("click", function () {
                modal.style.display = "none";
                form.submit();  // Lưu vào database
            });
        });
    </script>

    <style>
        form {
            background-color: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            max-width: 700px;
            margin: 30px auto;
        }

        h3 {
            text-align: center;
            color: #0d6efd;
            font-weight: bold;
        }

        label {
            font-weight: 500;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ced4da;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

            .form-control:focus, .form-select:focus {
                border-color: #0d6efd;
                box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.2);
            }

        .btn-primary {
            padding: 10px 25px;
            font-weight: 500;
            border-radius: 8px;
        }

        .alert-success {
            background-color: #d1e7dd;
            border: 1px solid #badbcc;
            border-radius: 8px;
            padding: 15px;
            color: #0f5132;
            margin-bottom: 20px;
            font-size: 15px;
        }

        span.text-danger {
            font-size: 14px;
        }
    </style>
}